-- ============================================================================
-- KEYMAPS CONFIGURATION
-- ============================================================================

vim.g.mapleader = " "
vim.g.maplocalleader = "\\"

local map = vim.keymap.set
local opts_desc = function(desc)
  return { silent = true, noremap = true, desc = desc }
end

-- ============================================================================
-- РЕЖИМЫ (Insert Mode)
-- ============================================================================

map("i", "jk", "<ESC>", opts_desc("Перейти в Normal mode"))

-- ============================================================================
-- ПЕРЕМЕЩЕНИЕ СТРОК И БЛОКОВ (Normal & Visual Mode)
-- ============================================================================

map("n", "<M-j>", ":m .+1<CR>==", opts_desc("Переместить строку вниз"))
map("n", "<M-k>", ":m .-2<CR>==", opts_desc("Переместить строку вверх"))

map("v", "<M-j>", ":m '>+1<CR>gv=gv", opts_desc("Переместить блок вниз"))
map("v", "<M-k>", ":m '<-2<CR>gv=gv", opts_desc("Переместить блок вверх"))

-- ============================================================================
-- ПОИСК (Normal Mode)
-- ============================================================================

map("n", "<ESC>", ":nohl<CR>", opts_desc("Очистить подсветку поиска"))

-- ============================================================================
-- УПРАВЛЕНИЕ ОКНАМИ (Window Management)
-- ============================================================================

-- Разделение окон
map("n", "<leader>sv", "<C-w>v", opts_desc("Разделить окно вертикально"))
map("n", "<leader>sh", "<C-w>s", opts_desc("Разделить окно горизонтально"))
map("n", "<leader>se", "<C-w>=", opts_desc("Сделать окна одинакового размера"))
map("n", "<leader>sx", "<cmd>close<CR>", opts_desc("Закрыть текущее окно"))

-- Навигация между окнами
map("n", "<C-h>", "<C-w>h", opts_desc("Перейти на левое окно"))
map("n", "<C-j>", "<C-w>j", opts_desc("Перейти на нижнее окно"))
map("n", "<C-k>", "<C-w>k", opts_desc("Перейти на верхнее окно"))
map("n", "<C-l>", "<C-w>l", opts_desc("Перейти на правое окно"))

-- Изменение размера окон
map("n", "<C-Left>", ":vertical resize -2<CR>", opts_desc("Уменьшить ширину окна"))
map("n", "<C-Right>", ":vertical resize +2<CR>", opts_desc("Увеличить ширину окна"))
map("n", "<C-Down>", ":resize -2<CR>", opts_desc("Уменьшить высоту окна"))
map("n", "<C-Up>", ":resize +2<CR>", opts_desc("Увеличить высоту окна"))

-- ============================================================================
-- ОТСТУПЫ (Visual Mode)
-- ============================================================================

map("v", "<", "<gv", opts_desc("Отступ влево (с сохранением выделения)"))
map("v", ">", ">gv", opts_desc("Отступ вправо (с сохранением выделения)"))

-- ============================================================================
-- ПОЛЕЗНЫЕ СОЧЕТАНИЯ (Utility Mappings)
-- ============================================================================

-- Быстрое сохранение
map("n", "<C-s>", "<cmd>write<CR>", opts_desc("Сохранить файл"))

-- Быстрое выделение всего
map("n", "<leader>a", "ggVG", opts_desc("Выделить весь файл"))

-- Центрирование при поиске
map("n", "n", "nzzzv", opts_desc("Следующее совпадение (в центре)"))
map("n", "N", "Nzzzv", opts_desc("Предыдущее совпадение (в центре)"))

-- Более удобное перемещение по тексту
map("n", "J", "mzJ`z", opts_desc("Объединить строку без перемещения курсора"))

-- Лучшая навигация при использовании длинных строк
map("n", "k", "v:count == 0 ? 'gk' : 'k'", { expr = true, silent = true })
map("n", "j", "v:count == 0 ? 'gj' : 'j'", { expr = true, silent = true })

-- ============================================================================
-- MARKDOWN СПЕЦИФИЧНЫЕ СОЧЕТАНИЯ
-- ============================================================================

-- Создание заголовков
map("n", "<leader>mh1", "I# <ESC>", opts_desc("H1 заголовок"))
map("n", "<leader>mh2", "I## <ESC>", opts_desc("H2 заголовок"))
map("n", "<leader>mh3", "I### <ESC>", opts_desc("H3 заголовок"))
map("n", "<leader>mh4", "I#### <ESC>", opts_desc("H4 заголовок"))

-- Форматирование текста
map("v", "<leader>mb", "c**<ESC>pa**<ESC>", opts_desc("Жирный текст"))
map("v", "<leader>mi", "c*<ESC>pa*<ESC>", opts_desc("Курсив"))
map("v", "<leader>mc", "c`<ESC>pa`<ESC>", opts_desc("Код"))
map("v", "<leader>ml", "c[<ESC>pa](<ESC>)<ESC>", opts_desc("Ссылка"))

-- Списки
map("n", "<leader>mlb", "I- <ESC>", opts_desc("Маркированный список"))
map("n", "<leader>mnb", "I1. <ESC>", opts_desc("Нумерованный список"))

-- Markdown предпросмотр
map("n", "<leader>mp", "<cmd>MarkdownPreviewToggle<CR>", opts_desc("Переключить предпросмотр Markdown"))

-- Выравнивание таблиц
map("v", "<leader>mt", ":Tabularize /|<CR>", opts_desc("Выровнять таблицу"))
map("n", "<leader>mt", ":Tabularize /|<CR>", opts_desc("Выровнять таблицу"))

-- Вставка таблицы
map("n", "<leader>mii", "o| Header 1 | Header 2 | Header 3 |<CR>|----------|----------|----------|<CR>| Cell 1   | Cell 2   | Cell 3   |<CR><ESC>k", opts_desc("Вставить таблицу 3x3"))

-- Конверт в кодовый блок
map("v", "<leader>mc", "c```<ESC>pa```<ESC>", opts_desc("Обернуть в кодовый блок"))

-- Горизонтальная линия
map("n", "<leader>mr", "i---<ESC>", opts_desc("Горизонтальная линия"))
